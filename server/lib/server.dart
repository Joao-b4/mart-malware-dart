import 'dart:io';
import 'dart:async';
import 'package:server/models/client.dart';

Socket socket;
ServerSocket serverSocket;

//InternetAddress.anyIPv4 = get ip now
List<Client> clients = [];

void listen(){
  ServerSocket.bind("127.0.0.1", 6661).then(
    (ServerSocket server) {
      serverSocket = server;
      print("Server listen: ${serverSocket.address.address}:${serverSocket.port}");
      serverSocket.listen(
        _dataHandler, 
       onError: _errorHandler, 
       onDone: _successfulHandler, 
       cancelOnError: false,
       );
    }
  );
  stdin.listen((data) => socket.write(new String.fromCharCodes(data).trim() + '\n\r'));

}

void _dataHandler(Socket socketClient){
   socket = socketClient;

   print(socket.remoteAddress.address);
   Client newClientForListen = new Client(socket);
   clients.add(newClientForListen);
}

void _errorHandler(dynamic errorObject, StackTrace stackError)
 => print("Error -> ${errorObject.toString}");

void _successfulHandler() => print("Done Connect!");