import 'package:client/host.dart';
import 'package:client/modules/modules.dart';
import 'package:client/util/manipulate_data.dart';

Modules modules = Modules();
Host host = Host("localhost", 6661);

main(List<String> arguments) {
  host.connect(dataHandler);
  host.write(modules.modulesAvailableForSelection());
}

dataHandler(String text) async {
  try {
    var requestMap = ManipulateData.convertJsonToMap(text);

    if (requestMap.containsKey("id") &&
        requestMap.containsKey("id") != "" &&
        ManipulateData.checkStringIsInt(requestMap["id"])) {
      var id = int.parse(requestMap["id"]);

      String parameter = requestMap["parameter"] ?? "";

      var responseModule =
          await modules.selector(id: id, parameter: parameter, host: host);
      host.write(responseModule);
    } else {
      host.write("error in ID");
    }
  } catch (error) {
    print(error.toString());
    host.write("error in processing data -> ${error.toString()}");
  }
}
