import '../modules/system.dart';
import '../modules/crypto.dart';
import '../util/manipulate_data.dart';

class Modules {
  System _system;

  Modules() {
    _system = System();
  }

  Future<Map> selectorFromMap(Map map) async {
    if (map != null &&
        map.containsKey("id") &&
        map['id'] != "" &&
        ManipulateData.isInt(map["id"])) {
      int id = int.parse(map["id"]);
      switch (id) {
        case 1:
          return getInfo();
        case 2:
          String parameter = map["parameter"].toString();

          Map retn = await executableCommand(parameter);
          return retn;
        case 3:
          String parameter = map["parameter"].toString();

          Map retn = await executableCommandInPowerShell(parameter);
          return retn;
        case 4:
          String parameter = map["parameter"].toString();

          if (ManipulateData.isInt(parameter)) {
            Map retn = await killProcess(int.parse(parameter));
            return retn;
          }
          return {"status": false, "response": "parameter is not a int"};
        case 5:
          String path = map['path'];
          String key = map['key'];
          Map retn = await encryptPath(path, key);
          return retn;
        case 6:
          String path = map['path'];
          String key = map['key'];
          Map retn = await decryptPath(path, key);
          return retn;
      }
    }
  }

  Map getInfo() {
    return _system.getInfoFromSystem();
  }

  Future<Map> executableCommand(String command) {
    return _system.executableCommand(command);
  }

  Future<Map> executableCommandInPowerShell(String command) {
    return _system.executableCommandInPowerShell(command);
  }

  Future<Map> killProcess(int pId) {
    return _system.killProcess(pId);
  }

  Future<Map> encryptPath(String path, String key) {
    if (key.length != 32) {
      return Future.value(
          {"status": false, "response": "key must be 32 characters"});
    }
    Crypto crypto = Crypto(path, key);
    return crypto.encryptFile();
  }

  Future<Map> decryptPath(String path, String key) {
    if (key.length != 32) {
      return Future.value(
          {"status": false, "response": "key must be 32 characters"});
    }
    Crypto crypto = Crypto(path, key);
    return crypto.decryptFile();
  }
}
